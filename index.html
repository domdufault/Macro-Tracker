<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b0d12" />
  <title>Dom’s Daily Macros</title>

  <style>
    :root{
      --bg0:#0b0d12;
      --bg1:#10131a;

      --panel: rgba(23,26,33,0.88);
      --panel2: rgba(0,0,0,0.14);
      --inputBg: rgba(0,0,0,0.18);

      --border: rgba(255,255,255,0.08);
      --shadow: rgba(0,0,0,0.25);
      --text:#e9ecf1;
      --muted:#aab2c0;

      --btnBg:#202535;
      --btnText:#ffffff;
      --btnMutedBg:#141824;
      --btnMutedText:#e9ecf1;
      --dangerBg:#2a1420;
      --dangerText:#e9ecf1;

      --ringTrack:#2a2f3a;
      --calColor:#ffb703;
      --proColor:#7ee081;
      --fatColor:#4dabff;
      --fibColor:#b08cff;

      --iconBg: rgba(0,0,0,0.20);
      --iconBgHover: rgba(0,0,0,0.28);
      --iconText: var(--text);

      --circ:289.02652413026095;
    }

    body.light{
      --bg0:#f5f7fb;
      --bg1:#e9eef8;

      --panel: rgba(255,255,255,0.92);
      --panel2: rgba(255,255,255,0.88);
      --inputBg: rgba(255,255,255,0.95);

      --border: rgba(10,18,32,0.10);
      --shadow: rgba(10,18,32,0.12);
      --text:#0c1220;
      --muted:#465063;

      --btnBg:#0f172a;
      --btnText:#ffffff;
      --btnMutedBg:#eef2fb;
      --btnMutedText:#0c1220;
      --dangerBg:#ffe7ee;
      --dangerText:#0c1220;

      --ringTrack:#d7deeb;

      --iconBg: rgba(10,18,32,0.06);
      --iconBgHover: rgba(10,18,32,0.10);
      --iconText:#0c1220;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:linear-gradient(180deg,var(--bg0), var(--bg1));
      color:var(--text);
    }

    .wrap{max-width:980px;margin:0 auto;padding:18px; position:relative;}

    .headerRow{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin: 6px 0 14px;
    }

    .title{
      font-size:44px;
      font-weight:950;
      letter-spacing:-0.03em;
      line-height:1.05;
      margin:0;
    }

    .iconBtn{
      width:46px;height:46px;
      border-radius:14px;
      border:1px solid var(--border);
      background:var(--iconBg);
      color:var(--iconText);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:0;
      box-shadow:0 8px 18px var(--shadow);
      flex:0 0 auto;
    }
    .iconBtn:active{ transform: translateY(1px); }
    .iconBtn:hover{ background:var(--iconBgHover); }
    .iconBtn svg{ width:22px; height:22px; display:block; fill: currentColor; }

    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:18px;
      padding:14px;
      box-shadow:0 10px 30px var(--shadow);
      backdrop-filter: blur(10px);
      margin-bottom:12px;
    }

    .sectionHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .sectionTitle{
      font-size:18px;
      font-weight:950;
      letter-spacing:-0.02em;
    }

    .rings{
      display:grid;
      grid-template-columns:repeat(2,1fr);
      gap:12px;
    }
    @media(min-width:820px){
      .rings{grid-template-columns:repeat(4,1fr)}
    }

    .ringCard{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      padding:14px;
      background:var(--panel2);
      border-radius:16px;
      border:1px solid var(--border);
    }

    .ringLabel{font-weight:950;font-size:20px}
    .ring{ width:118px;height:118px;position:relative; }
    .ring svg{width:118px;height:118px;transform:rotate(-90deg)}
    .center{
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      gap:2px;
    }
    .big{font-size:24px;font-weight:950}
    .small{font-size:12px;color:var(--muted)}
    .track{stroke:var(--ringTrack);stroke-width:10;fill:none}
    .prog{
      stroke-width:10; fill:none; stroke-linecap:round;
      stroke-dasharray:var(--circ); stroke-dashoffset:var(--circ);
    }
    .ringNums{font-size:13px;color:var(--muted);font-weight:800}

    /* Add Entry: 2x2 on phones, 4 across on larger screens */
    .formRow{
      display:grid;
      gap:10px;
      margin-top:10px;
      grid-template-columns:repeat(2, minmax(0,1fr));
    }
    @media (min-width: 760px){
      .formRow{ grid-template-columns:repeat(4, minmax(0,1fr)); }
    }

    input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:var(--inputBg);
      color:var(--text);
      outline:none;
      font-weight:800;
      min-width:0;
    }
    input::placeholder{color:color-mix(in srgb, var(--muted) 75%, transparent)}

    .btnRow{
      display:flex;
      gap:10px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    button.primary{
      padding:11px 14px;
      border-radius:14px;
      border:1px solid var(--border);
      background:var(--btnBg);
      color:var(--btnText);
      font-weight:950;
      cursor:pointer;
    }
    button.primary:active{transform:translateY(1px)}
    button.mutedBtn{
      padding:11px 14px;
      border-radius:14px;
      border:1px solid var(--border);
      background:var(--btnMutedBg);
      color:var(--btnMutedText);
      font-weight:950;
      cursor:pointer;
    }
    button.danger{
      padding:11px 14px;
      border-radius:14px;
      border:1px solid var(--border);
      background:var(--dangerBg);
      color:var(--dangerText);
      font-weight:950;
      cursor:pointer;
    }

    .log{
      display:flex;
      flex-direction:column;
      gap:10px;
      max-height:520px;
      overflow:auto;
      padding-right:4px;
    }
    .entry{
      display:grid;
      grid-template-columns:1fr auto;
      gap:10px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid var(--border);
      background:var(--panel2);
      align-items:center;
    }
    .entry .vals{font-size:14px;font-weight:950}
    .entry .meta{font-size:12px;color:var(--muted);margin-top:2px;font-weight:800}

    .delBtn{
      width:36px;height:36px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.06);
      color:var(--text);
      font-weight:950;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    body.light .delBtn{ background:rgba(10,18,32,0.06); }

    .toggleRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .toggleLabel{ font-weight:950; color:var(--muted); }
    .switch{
      position:relative;
      width:58px;height:34px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,0.10);
      cursor:pointer;
      flex:0 0 auto;
    }
    body.light .switch{ background:rgba(10,18,32,0.06); }
    .knob{
      position:absolute;
      top:3px;left:3px;
      width:28px;height:28px;
      border-radius:999px;
      background:rgba(255,255,255,0.86);
      transition: transform 160ms ease;
    }
    body.light .knob{ background:#0f172a; }
    .switch.on .knob{ transform: translateX(24px); }

    .helpText{ color:var(--muted); font-size:12px; font-weight:800; margin-top:6px; }
    .hidden{display:none !important;}

    .statusPill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,0.08);
      font-size:12px;
      font-weight:900;
      color:var(--muted);
    }
    body.light .statusPill{ background:rgba(255,255,255,0.75); }
    .dot{
      width:9px;height:9px;border-radius:999px;
      background: #f59e0b;
    }
    .dot.ok{ background:#22c55e; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="headerRow">
      <h1 class="title">Dom’s Daily Macros</h1>

      <button class="iconBtn" id="openSettings" aria-label="Open settings" title="Settings" type="button">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 0 0 .12-.64l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.3 7.3 0 0 0-1.63-.94l-.36-2.54A.5.5 0 0 0 11.9 1h-3.8a.5.5 0 0 0-.49.42l-.36 2.54c-.58.23-1.12.54-1.63.94l-2.39-.96a.5.5 0 0 0-.6.22L.71 7.08a.5.5 0 0 0 .12.64l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94L.83 14.52a.5.5 0 0 0-.12.64l1.92 3.32c.13.22.39.3.6.22l2.39-.96c.5.4 1.05.71 1.63.94l.36 2.54c.04.24.25.42.49.42h3.8c.24 0 .45-.18.49-.42l.36-2.54c.58-.23 1.12-.54 1.63-.94l2.39.96c.22.09.47 0 .6-.22l1.92-3.32a.5.5 0 0 0-.12-.64l-2.03-1.58ZM10 15a3 3 0 1 1 0-6 3 3 0 0 1 0 6Z"/>
        </svg>
      </button>
    </div>

    <!-- TRACKER -->
    <div id="mainView">
      <div class="card">
        <div class="rings">
          <div class="ringCard">
            <div class="ringLabel">Calories</div>
            <div class="ring">
              <svg viewBox="0 0 120 120">
                <circle class="track" cx="60" cy="60" r="46"></circle>
                <circle class="prog" id="ringCal" cx="60" cy="60" r="46"></circle>
              </svg>
              <div class="center">
                <div class="big" id="calNow">0</div>
                <div class="small">/ <span id="calGoal">2000</span></div>
              </div>
            </div>
            <div class="ringNums"><span id="calRem">2000</span> remaining</div>
          </div>

          <div class="ringCard">
            <div class="ringLabel">Protein</div>
            <div class="ring">
              <svg viewBox="0 0 120 120">
                <circle class="track" cx="60" cy="60" r="46"></circle>
                <circle class="prog" id="ringPro" cx="60" cy="60" r="46"></circle>
              </svg>
              <div class="center">
                <div class="big" id="proNow">0</div>
                <div class="small">/ <span id="proGoal">120</span> g</div>
              </div>
            </div>
            <div class="ringNums"><span id="proRem">120</span> g needed</div>
          </div>

          <div class="ringCard">
            <div class="ringLabel">Fat</div>
            <div class="ring">
              <svg viewBox="0 0 120 120">
                <circle class="track" cx="60" cy="60" r="46"></circle>
                <circle class="prog" id="ringFat" cx="60" cy="60" r="46"></circle>
              </svg>
              <div class="center">
                <div class="big" id="fatNow">0</div>
                <div class="small">/ <span id="fatGoal">60</span> g</div>
              </div>
            </div>
            <div class="ringNums"><span id="fatRem">60</span> g needed</div>
          </div>

          <div class="ringCard">
            <div class="ringLabel">Fiber</div>
            <div class="ring">
              <svg viewBox="0 0 120 120">
                <circle class="track" cx="60" cy="60" r="46"></circle>
                <circle class="prog" id="ringFib" cx="60" cy="60" r="46"></circle>
              </svg>
              <div class="center">
                <div class="big" id="fibNow">0</div>
                <div class="small">/ <span id="fibGoal">30</span> g</div>
              </div>
            </div>
            <div class="ringNums"><span id="fibRem">30</span> g needed</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="sectionHead">
          <div class="sectionTitle">Add Entry</div>
        </div>

        <div class="formRow">
          <input id="inCal" inputmode="numeric" placeholder="Calories">
          <input id="inPro" inputmode="numeric" placeholder="Protein (g)">
          <input id="inFat" inputmode="numeric" placeholder="Fat (g)">
          <input id="inFib" inputmode="numeric" placeholder="Fiber (g)">
        </div>

        <div class="btnRow">
          <button class="primary" id="addBtn" type="button">Add Entry</button>
          <button class="mutedBtn" id="clearBtn" type="button">Clear</button>
        </div>
      </div>

      <div class="card">
        <div class="sectionHead">
          <div class="sectionTitle">Today’s Log</div>
        </div>
        <div class="log" id="log"></div>
      </div>
    </div>

    <!-- SETTINGS -->
    <div id="settingsView" class="hidden">
      <div class="card">
        <div class="sectionHead">
          <div class="sectionTitle">Settings</div>
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <div class="statusPill" id="syncStatus">
              <span class="dot" id="syncDot"></span>
              <span id="syncText">Not signed in</span>
            </div>
            <button class="mutedBtn" id="closeSettings" type="button">Done</button>
          </div>
        </div>
        <div class="helpText">To sync iPhone + iPad automatically, sign in on both devices with the same email/password.</div>
      </div>

      <div class="card">
        <div class="sectionHead">
          <div class="sectionTitle">Cloud Sync</div>
        </div>

        <div class="formRow" style="margin-top:0;">
          <input id="authEmail" inputmode="email" placeholder="Email">
          <input id="authPass" type="password" placeholder="Password">
          <div style="grid-column:1 / -1;">
            <div class="btnRow" style="margin-top:0;">
              <button class="primary" id="signUpBtn" type="button">Create Account</button>
              <button class="primary" id="signInBtn" type="button">Sign In</button>
              <button class="mutedBtn" id="signOutBtn" type="button">Sign Out</button>
            </div>
          </div>
        </div>

        <div class="helpText">Once signed in, your log + goals sync automatically between devices.</div>
      </div>

      <div class="card">
        <div class="sectionHead">
          <div class="sectionTitle">Appearance</div>
        </div>

        <div class="toggleRow">
          <div class="toggleLabel">Light mode</div>
          <div class="switch" id="themeSwitch" role="switch" aria-checked="false" tabindex="0">
            <div class="knob"></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="sectionHead">
          <div class="sectionTitle">Goals</div>
        </div>

        <div class="formRow" style="margin-top:0;">
          <input id="setCal" inputmode="numeric" placeholder="Calories goal">
          <input id="setPro" inputmode="numeric" placeholder="Protein goal (g)">
          <input id="setFat" inputmode="numeric" placeholder="Fat goal (g)">
          <input id="setFib" inputmode="numeric" placeholder="Fiber goal (g)">
        </div>

        <div class="btnRow">
          <button class="primary" id="saveGoals" type="button">Save Goals</button>
        </div>
        <div class="helpText">Set these once, then use the tracker daily.</div>
      </div>

      <div class="card">
        <div class="sectionHead">
          <div class="sectionTitle">Reset</div>
        </div>
        <button class="danger" id="resetBtn" type="button">Reset Day</button>
      </div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      getDoc,
      onSnapshot,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // ✅ FROM YOUR SCREENSHOT
    const firebaseConfig = {
      apiKey: "AIzaSyD0Q8X6uFwvGg5ldipbj4fudrILbjXMcP0",
      authDomain: "dom-macros.firebaseapp.com",
      projectId: "dom-macros",
      storageBucket: "dom-macros.firebasestorage.app",
      messagingSenderId: "474678978002",
      appId: "1:474678978002:web:d85105dfc88ab3cb78140b",
      measurementId: "G-5MQXX0QJM0"
    };

    const hasConfig = firebaseConfig && firebaseConfig.projectId;

    const KEY_LOCAL = "dom_macros_local_v1";
    const KEY_THEME = "dom_macros_theme_v6";

    let goals = { cal:2000, pro:120, fat:60, fib:30 };
    let state = { totals:{cal:0,pro:0,fat:0,fib:0}, log:[] };

    const $ = (id) => document.getElementById(id);

    let app = null, auth = null, db = null;
    let unsubSnap = null;
    let currentUid = null;
    let suppressRemoteApply = false;

    function saveLocal(){
      localStorage.setItem(KEY_LOCAL, JSON.stringify({goals, state}));
    }
    function loadLocal(){
      const raw = localStorage.getItem(KEY_LOCAL);
      if(raw){
        try{
          const data = JSON.parse(raw);
          if (data?.goals) goals = data.goals;
          if (data?.state) state = data.state;
        }catch(e){}
      }
    }

    function setTheme(theme, persist=true){
      const isLight = theme === "light";
      document.body.classList.toggle("light", isLight);

      const sw = $("themeSwitch");
      if (sw){
        sw.classList.toggle("on", isLight);
        sw.setAttribute("aria-checked", String(isLight));
      }

      const meta = document.querySelector('meta[name="theme-color"]');
      if (meta) meta.setAttribute("content", isLight ? "#f5f7fb" : "#0b0d12");

      if(persist) localStorage.setItem(KEY_THEME, theme);
    }
    function loadTheme(){
      const t = localStorage.getItem(KEY_THEME) || "dark";
      setTheme(t, false);
    }
    function toggleTheme(){
      const isLight = document.body.classList.contains("light");
      setTheme(isLight ? "dark" : "light");
      pushRemote();
    }

    function setRing(el, value, goal, colorVar){
      const pct = goal === 0 ? 0 : Math.min(value / goal, 1);
      const dash = 289.02652413026095;
      el.style.strokeDasharray = dash;
      el.style.strokeDashoffset = dash * (1 - pct);
      el.style.stroke = getComputedStyle(document.documentElement).getPropertyValue(colorVar).trim();
    }

    function recalc(){
      const t = {cal:0,pro:0,fat:0,fib:0};
      state.log.forEach(e=>{
        t.cal+=e.cal; t.pro+=e.pro; t.fat+=e.fat; t.fib+=e.fib;
      });
      state.totals = t;
    }

    function nowTime(){
      const d = new Date();
      return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }

    function addEntry(cal, pro, fat, fib){
      const entry = {
        id: Date.now().toString(36) + Math.random().toString(36).slice(2,8),
        cal: Math.round(cal),
        pro: Math.round(pro*10)/10,
        fat: Math.round(fat*10)/10,
        fib: Math.round(fib*10)/10,
        time: nowTime()
      };
      state.log.push(entry);
      recalc();
      saveLocal();
      render();
      pushRemote();
    }

    function deleteEntry(id){
      state.log = state.log.filter(e => e.id !== id);
      recalc();
      saveLocal();
      render();
      pushRemote();
    }

    function render(){
      $("calGoal").textContent = goals.cal;
      $("proGoal").textContent = goals.pro;
      $("fatGoal").textContent = goals.fat;
      $("fibGoal").textContent = goals.fib;

      $("calNow").textContent = state.totals.cal;
      $("proNow").textContent = state.totals.pro;
      $("fatNow").textContent = state.totals.fat;
      $("fibNow").textContent = state.totals.fib;

      $("calRem").textContent = Math.max(0, Math.round(goals.cal - state.totals.cal));
      $("proRem").textContent = Math.max(0, Math.round((goals.pro - state.totals.pro) * 10)/10);
      $("fatRem").textContent = Math.max(0, Math.round((goals.fat - state.totals.fat) * 10)/10);
      $("fibRem").textContent = Math.max(0, Math.round((goals.fib - state.totals.fib) * 10)/10);

      setRing($("ringCal"), state.totals.cal, goals.cal, "--calColor");
      setRing($("ringPro"), state.totals.pro, goals.pro, "--proColor");
      setRing($("ringFat"), state.totals.fat, goals.fat, "--fatColor");
      setRing($("ringFib"), state.totals.fib, goals.fib, "--fibColor");

      $("setCal").value = goals.cal;
      $("setPro").value = goals.pro;
      $("setFat").value = goals.fat;
      $("setFib").value = goals.fib;

      const logEl = $("log");
      logEl.innerHTML = "";
      if (!state.log.length){
        const empty = document.createElement("div");
        empty.className = "helpText";
        empty.textContent = "No entries yet.";
        logEl.appendChild(empty);
        return;
      }
      [...state.log].slice().reverse().forEach(e=>{
        const row = document.createElement("div");
        row.className = "entry";

        const left = document.createElement("div");
        left.innerHTML = `
          <div class="vals">${e.cal} cal • ${e.pro}P • ${e.fat}F • ${e.fib} fiber</div>
          <div class="meta">${e.time}</div>
        `;

        const del = document.createElement("button");
        del.className = "delBtn";
        del.type = "button";
        del.textContent = "✕";
        del.title = "Delete entry";
        del.onclick = () => deleteEntry(e.id);

        row.appendChild(left);
        row.appendChild(del);
        logEl.appendChild(row);
      });
    }

    function showTracker(){
      $("mainView").classList.remove("hidden");
      $("settingsView").classList.add("hidden");
      window.scrollTo(0,0);
    }
    function showSettings(){
      $("mainView").classList.add("hidden");
      $("settingsView").classList.remove("hidden");
      window.scrollTo(0,0);
    }

    function setSyncStatus(text, ok=false){
      $("syncText").textContent = text;
      $("syncDot").classList.toggle("ok", ok);
    }

    function userDocRef(uid){
      return doc(db, "users", uid);
    }

    async function pushRemote(){
      if(!hasConfig) return;
      if(!db || !currentUid) return;
      if(suppressRemoteApply) return;

      const theme = document.body.classList.contains("light") ? "light" : "dark";

      try{
        await setDoc(userDocRef(currentUid), {
          goals,
          state,
          theme,
          updatedAt: serverTimestamp()
        }, { merge: true });
        setSyncStatus("Synced", true);
      }catch(e){
        setSyncStatus("Sync error", false);
      }
    }

    function startRealtimeSync(uid){
      if(!hasConfig) return;
      if(unsubSnap) unsubSnap();

      const ref = userDocRef(uid);
      unsubSnap = onSnapshot(ref, (snap) => {
        if(!snap.exists()){
          pushRemote();
          return;
        }
        const data = snap.data() || {};

        suppressRemoteApply = true;
        try{
          if(data.goals) goals = data.goals;
          if(data.state) state = data.state;

          if(data.theme === "light" || data.theme === "dark"){
            setTheme(data.theme, true);
          }

          recalc();
          saveLocal();
          render();
          setSyncStatus("Synced", true);
        } finally {
          setTimeout(()=>{ suppressRemoteApply = false; }, 150);
        }
      }, () => {
        setSyncStatus("Sync error", false);
      });
    }

    function initFirebase(){
      if(!hasConfig){
        setSyncStatus("Paste Firebase config", false);
        return;
      }
      app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);

      onAuthStateChanged(auth, async (user) => {
        if(user){
          currentUid = user.uid;
          setSyncStatus("Signed in • syncing", true);
          startRealtimeSync(user.uid);

          try{
            const snap = await getDoc(userDocRef(user.uid));
            if(!snap.exists()){
              await pushRemote();
            }
          }catch(e){}
        } else {
          currentUid = null;
          if(unsubSnap){ unsubSnap(); unsubSnap = null; }
          setSyncStatus("Not signed in", false);
        }
      });
    }

    $("openSettings").onclick = showSettings;
    $("closeSettings").onclick = showTracker;

    $("addBtn").onclick = () => {
      const cal = Number($("inCal").value) || 0;
      const pro = Number($("inPro").value) || 0;
      const fat = Number($("inFat").value) || 0;
      const fib = Number($("inFib").value) || 0;
      if(!cal && !pro && !fat && !fib) return;
      addEntry(cal, pro, fat, fib);
      $("inCal").value = "";
      $("inPro").value = "";
      $("inFat").value = "";
      $("inFib").value = "";
    };

    $("clearBtn").onclick = () => {
      $("inCal").value = "";
      $("inPro").value = "";
      $("inFat").value = "";
      $("inFib").value = "";
    };

    $("saveGoals").onclick = () => {
      goals = {
        cal: Number($("setCal").value) || goals.cal,
        pro: Number($("setPro").value) || goals.pro,
        fat: Number($("setFat").value) || goals.fat,
        fib: Number($("setFib").value) || goals.fib
      };
      recalc();
      saveLocal();
      render();
      pushRemote();
      alert("Goals updated!");
    };

    $("resetBtn").onclick = () => {
      if(confirm("Reset today’s totals and clear the log?")){
        state = { totals:{cal:0,pro:0,fat:0,fib:0}, log:[] };
        recalc();
        saveLocal();
        render();
        pushRemote();
        showTracker();
      }
    };

    $("themeSwitch").onclick = toggleTheme;
    $("themeSwitch").addEventListener("keydown", (e)=>{
      if(e.key === "Enter" || e.key === " "){
        e.preventDefault();
        toggleTheme();
      }
    });

    $("signUpBtn").onclick = async () => {
      const email = $("authEmail").value.trim();
      const pass = $("authPass").value;
      if(!email || !pass){ alert("Enter email + password."); return; }
      try{
        await createUserWithEmailAndPassword(auth, email, pass);
        alert("Account created! Sign in on your other device with the same email/password.");
      }catch(e){
        alert(e?.message || "Could not create account.");
      }
    };

    $("signInBtn").onclick = async () => {
      const email = $("authEmail").value.trim();
      const pass = $("authPass").value;
      if(!email || !pass){ alert("Enter email + password."); return; }
      try{
        await signInWithEmailAndPassword(auth, email, pass);
      }catch(e){
        alert(e?.message || "Could not sign in.");
      }
    };

    $("signOutBtn").onclick = async () => {
      try{ await signOut(auth); }catch(e){}
    };

    loadTheme();
    loadLocal();
    recalc();
    render();
    showTracker();
    initFirebase();
  </script>
</body>
</html>